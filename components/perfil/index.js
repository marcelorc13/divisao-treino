'use client'

import './perfil.css'

import { useEffect, useState } from "react"
import { collection, getDoc, getDocs, doc, query } from "firebase/firestore"
import { db } from "@/app/firebaseconnection"

export default function Perfil() {
    const [uid, setUid] = useState()

    const [infos, setInfos] = useState({})

    const [pesos, setPesos] = useState([])

    useEffect(() => {
        const userId = localStorage.getItem('UidLogado')
        setUid(userId)

        const ReceberDados = async () => {
            const docSnapDados = await getDoc(doc(db, 'users', userId))

            const infosUser = docSnapDados.data()
            setInfos(infosUser)
        }

        const ReceberEvolucao = async () => {
            const q = query(collection(db, 'users', userId, 'pesos'))
            const querySnapshot = await getDocs(q)

            const pesosArr = []

            querySnapshot.forEach((doc) => {
                pesosArr.push(doc.data())
            })

            setPesos(pesosArr)
        }

        ReceberDados()
        ReceberEvolucao()
    }, [])

    console.log(pesos)
    //console.log(infos)

    return (
        <main className='w-full flex flex-col gap-12 pt-12'>
            <div id='infosPerfil' className="flex flex-col items-center justify-center">
                <h1>{infos.nomeCompleto}</h1>
                <h2>{infos.nomeUsuario}</h2>
                <h3>{infos.email}</h3>
            </div>
            <div className='flex flex-col justify-center'>
                <h1 className='self-center text-xl font-semibold mb-2'>Meus Treinos:</h1>
                <div className='grid gap-4 grid-cols-1 md:grid-cols-2 lg:grid-cols-4 px-8'>
                    <div className='cardTreinos'>
                        <h1>Em breve...</h1>
                    </div>

                    <div className='cardTreinos'>
                        <h1>Em breve...</h1>
                    </div>

                    <div className='cardTreinos'>
                        <h1>Em breve...</h1>
                    </div>

                    <div className='cardTreinos'>
                        <h1>Em breve...</h1>
                    </div>
                </div>
            </div>
            <div className='flex flex-col justify-center'>
                <h1 className='self-center text-xl font-semibold mb-2'>Minha Evolução:</h1>
                <div className='grid gap-4 grid-cols-1 md:grid-cols-2 lg:grid-cols-4 px-8'>
                    {pesos.map((peso, key) => (
                        <div key={key} className='cardTreinos'>
                            <p>Data: <span>{peso.peso.data}</span></p>
                            <p>Peso: <span>{peso.peso.peso}Kg</span></p>
                        </div>
                    ))
                    } 
                </div>
            </div>
        </main>
    )
}